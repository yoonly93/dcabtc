<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>비트코인 목표 수량 투자 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-50 p-4">

  <!-- 상단 카드형 입력 -->
  <div class="max-w-xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-4">
    <h1 class="text-xl font-bold text-center">비트코인 목표 수량 투자 계산기</h1>

    <!-- 목표 BTC -->
    <div>
      <label class="block font-medium mb-1">목표 비트코인 개수</label>
      <input type="number" id="targetBtc" class="w-full border p-2 rounded" placeholder="예: 0.5">
    </div>

    <!-- 투입금액 -->
    <div class="relative">
      <label class="block font-medium mb-1">투입금액</label>
      <input type="number" id="monthlyInvestment" class="w-full border p-2 rounded pr-10" placeholder="예: 1000000" oninput="toggleClearIcon()">
      <!-- Clear 버튼 아이콘 -->
      <span class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer" id="clearBtn" style="display:none;" onclick="clearInvestment()">
        <i data-feather="x-circle"></i>
      </span>
      <div class="flex space-x-2 mt-2">
        <button type="button" onclick="addInvestment(100000)" class="flex-1 bg-gray-200 px-3 py-1 rounded">+10만원</button>
        <button type="button" onclick="addInvestment(1000000)" class="flex-1 bg-gray-200 px-3 py-1 rounded">+100만원</button>
        <button type="button" onclick="addInvestment(10000000)" class="flex-1 bg-gray-200 px-3 py-1 rounded">+1000만원</button>
      </div>
      <div class="text-sm text-gray-500 mt-1" id="investmentDisplay">0원</div>
    </div>

    <!-- 월별 상승률 -->
    <div>
      <label class="block font-medium mb-1">월별 예상 상승률 (%)</label>
      <input type="number" id="monthlyRate" class="w-full border p-2 rounded" value="5">
    </div>

    <!-- 확인하기 버튼 -->
    <button onclick="calculateBTC()" class="w-full bg-orange-500 text-white py-2 rounded font-semibold">확인하기</button>
  </div>

  <!-- 결과 영역 -->
  <div class="max-w-xl mx-auto mt-6 bg-white p-6 rounded-xl shadow-md space-y-3" id="resultCard" style="display:none;">
    <h2 class="text-lg font-bold">계산 결과</h2>
    <p>필요기간: <span id="requiredMonths"></span>개월</p>
    <p>총 투입 금액: <span id="totalInvestment"></span></p>
  </div>

  <!-- 주의사항 -->
  <div class="max-w-xl mx-auto mt-4 bg-yellow-100 p-4 rounded-lg text-sm text-gray-700 space-y-1">
    <p>이 계산기는 교육적 목적의 시뮬레이션이며, 실제 결과를 보장하지 않습니다.</p>
    <p>이 계산은 비트코인 가격이 매월 설정한 %만큼 꾸준히 상승한다고 가정합니다.</p>
    <p>각 월의 BTC 가격 = 이전 월 가격 × (1 + 월별상승률/100)</p>
  </div>

  <!-- 참고 버튼 -->
  <div class="max-w-xl mx-auto mt-4 text-center">
    <a href="https://btc-reach-calculator.vercel.app/" target="_blank"
       class="inline-block w-full bg-white text-orange-500 border border-orange-500 font-semibold py-2 px-4 rounded hover:bg-orange-50 transition-colors text-center">
      한국에서 지금 200만원으로 비트코인을 사면 실제로 몇 개를 살 수 있을까?
    </a>
  </div>

  <!-- 월별 테이블 -->
  <div class="max-w-xl mx-auto mt-6 overflow-x-auto">
    <table class="w-full table-auto border border-gray-300">
      <thead class="bg-gray-100">
        <tr>
          <th class="border px-2 py-1">월차</th>
          <th class="border px-2 py-1">투입금액</th>
          <th class="border px-2 py-1">해당월 BTC 가격</th>
          <th class="border px-2 py-1">구매 BTC</th>
          <th class="border px-2 py-1">누적 BTC</th>
        </tr>
      </thead>
      <tbody id="monthlyTable"></tbody>
    </table>
  </div>

  <script>
    feather.replace();

    // 업비트 KRW-BTC 가격 가져오기
    async function fetchBtcPrice() {
      try {
        const res = await fetch('https://api.upbit.com/v1/ticker?markets=KRW-BTC');
        const data = await res.json();
        return parseFloat(data[0].trade_price);
      } catch (err) {
        console.error('업비트 BTC 가격 조회 실패', err);
        return 50000000; // fallback
      }
    }

    function formatWon(value) {
      return value.toLocaleString() + '원';
    }

    function formatInvestmentDisplay(value) {
      if (!value || value <= 0) return '0원';
      if (value >= 10000) {
        return Math.round(value / 10000).toLocaleString() + '만원';
      } else {
        return value.toLocaleString() + '원';
      }
    }

    function toggleClearIcon() {
      const input = document.getElementById('monthlyInvestment');
      const btn = document.getElementById('clearBtn');
      btn.style.display = input.value ? 'block' : 'none';
      document.getElementById('investmentDisplay').textContent = formatInvestmentDisplay(parseInt(input.value));
    }

    function clearInvestment() {
      const input = document.getElementById('monthlyInvestment');
      input.value = '';
      toggleClearIcon();
    }

    function addInvestment(amount) {
      const input = document.getElementById('monthlyInvestment');
      let current = parseInt(input.value) || 0;
      current += amount;
      input.value = current;
      toggleClearIcon();
    }

    async function calculateBTC() {
      const targetBtc = parseFloat(document.getElementById('targetBtc').value);
      const monthlyInvestment = parseInt(document.getElementById('monthlyInvestment').value);
      const monthlyRate = parseFloat(document.getElementById('monthlyRate').value) / 100;

      if (!targetBtc || !monthlyInvestment || monthlyInvestment <= 0) {
        return alert('모든 값을 입력해주세요.');
      }

      const startPrice = await fetchBtcPrice();

      let currentBtcPrice = startPrice;
      let month = 0;
      let accumulatedBtc = 0;
      let monthlyTableHtml = '';

      while (accumulatedBtc < targetBtc) {
        month++;
        const btcBought = monthlyInvestment / currentBtcPrice;
        accumulatedBtc += btcBought;

        monthlyTableHtml += `<tr>
          <td class="border px-2 py-1">${month}개월차</td>
          <td class="border px-2 py-1">${formatInvestmentDisplay(monthlyInvestment)}</td>
          <td class="border px-2 py-1">${formatWon(Math.round(currentBtcPrice))}</td>
          <td class="border px-2 py-1">${btcBought.toFixed(6)}</td>
          <td class="border px-2 py-1">${accumulatedBtc.toFixed(6)}</td>
        </tr>`;

        currentBtcPrice *= (1 + monthlyRate);
      }

      document.getElementById('requiredMonths').textContent = month;
      document.getElementById('totalInvestment').textContent = formatInvestmentDisplay(month * monthlyInvestment);
      document.getElementById('monthlyTable').innerHTML = monthlyTableHtml;
      document.getElementById('resultCard').style.display = 'block';
    }
  </script>

</body>
</html>
